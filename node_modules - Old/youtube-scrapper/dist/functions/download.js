"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.download = void 0;
const downloadFromVideo_1 = require("./downloadFromVideo");
const getVideoInfo_1 = require("./getVideoInfo");
/**
 * Downloads a youtube stream using its url or id.
 * @param urlOrId The url or id of the song to download its stream.
 * @param format The format to use for the song.
 */
async function download(urlOrId, format) {
    const video = await getVideoInfo_1.getVideoInfo(urlOrId);
    if (format) {
        // If a format was provided, we can just use it instead.
        return downloadFromVideo_1.downloadFromVideo(video, format);
    }
    else {
        // This format is suitable for music bots.
        const opus = video.formats.find(c => c.codec === "opus" && c.hasAudio && c.url && !c.hasVideo);
        if (opus) {
            return downloadFromVideo_1.downloadFromVideo(video, opus);
        }
        else {
            // This will last available format.
            return downloadFromVideo_1.downloadFromVideo(video, video.formats[video.formats.length - 1]);
        }
    }
}
exports.download = download;
